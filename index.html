<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #time {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 10px;
            width: 300px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            outline: none;
        }

        .weather {
            font-size: 24px;
            margin-top: 15px;
        }

        .settings-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: white;
        }

        .settings-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 10px;
            background: #222;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        }

        .settings-menu label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .dark-mode {
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>

    <button class="settings-button" onclick="toggleSettings()">‚öôÔ∏è</button>

    <div class="settings-menu" id="settingsMenu">
        <label>
            <input type="checkbox" id="darkModeToggle"> Light Mode
        </label>
        <label>
            <input type="checkbox" id="timeFormatToggle"> 24-Hour Time
        </label>
        <label>
            <input type="checkbox" id="tempUnitToggle"> Use Fahrenheit
        </label>
    </div>

    <div class="container">
        <div id="time"></div>
        <form action="https://www.google.com/search" method="GET">
            <input type="text" name="q" placeholder="Search Google..." autocomplete="off">
        </form>
        <div class="weather" id="weather">Loading weather...</div>
    </div>

    <script>
        function updateTime() {
            let now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            let seconds = now.getSeconds();
            let is24Hour = localStorage.getItem("24HourTime") === "true";

            if (!is24Hour) {
                let ampm = hours >= 12 ? "PM" : "AM";
                hours = hours % 12 || 12;
                document.getElementById("time").textContent = 
                    `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")} ${ampm}`;
            } else {
                document.getElementById("time").textContent = 
                    `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            }
        }

        function updateWeather(latitude, longitude) {
            const isFahrenheit = localStorage.getItem("useFahrenheit") === "true";
            fetch(`https://wttr.in/${latitude},${longitude}?format=%t`)
                .then(response => response.text())
                .then(data => {
                    let temp = parseFloat(data.trim()); // Temperature in Fahrenheit

                    // Convert to Celsius if necessary
                    if (!isFahrenheit) {
                        temp = (temp - 32) * 5 / 9; // Convert Fahrenheit to Celsius
                    }

                    // Round the temperature to 1 decimal place for Celsius
                    temp = Math.round(temp * 10) / 10; // Round to 1 decimal place

                    // Fetch the city name using reverse geocoding (geocode.xyz)
                    fetch(`https://geocode.xyz/${latitude},${longitude}?json=1`)
                        .then(response => response.json())
                        .then(data => {
                            let city = data.city ? data.city : "Your location"; // Default city name if not found

                            // Correct the city case (capitalize)
                            city = city.charAt(0).toUpperCase() + city.slice(1).toLowerCase();

                            // Get the weather condition and map it to an emoji
                            fetch(`https://wttr.in/${latitude},${longitude}?format=%C`)
                                .then(response => response.text())
                                .then(condition => {
                                    let emoji = "‚ùì"; // Default emoji if the condition isn't recognized

                                    // Check if it's night time
                                    const currentTime = new Date();
                                    const isNight = currentTime.getHours() >= 18 || currentTime.getHours() < 6;

                                    if (condition.toLowerCase().includes("clear")) {
                                        emoji = isNight ? "üåô" : "‚òÄÔ∏è"; // Use moon for night and sun for day
                                    } else if (condition.toLowerCase().includes("cloud")) emoji = "‚òÅÔ∏è";
                                    else if (condition.toLowerCase().includes("rain")) emoji = "üåßÔ∏è";
                                    else if (condition.toLowerCase().includes("snow")) emoji = "‚ùÑÔ∏è";
                                    else if (condition.toLowerCase().includes("fog")) emoji = "üå´Ô∏è";
                                    else if (condition.toLowerCase().includes("thunder")) emoji = "‚õàÔ∏è";

                                    // Display weather info with the correct unit
                                    let unit = isFahrenheit ? "¬∞F" : "¬∞C";
                                    document.getElementById("weather").textContent = `${city}: ${temp}${unit} ${emoji}`;
                                });
                        });
                })
                .catch(() => document.getElementById("weather").textContent = "Weather unavailable");
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    let latitude = position.coords.latitude;
                    let longitude = position.coords.longitude;
                    updateWeather(latitude, longitude);
                }, function() {
                    document.getElementById("weather").textContent = "Weather unavailable";
                });
            } else {
                document.getElementById("weather").textContent = "Geolocation not supported";
            }
        }

        function toggleSettings() {
            let menu = document.getElementById("settingsMenu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function applyPreferences() {
            let isDarkMode = localStorage.getItem("darkMode") === "true";
            document.body.classList.toggle("dark-mode", isDarkMode);
            document.getElementById("darkModeToggle").checked = isDarkMode;

            let is24Hour = localStorage.getItem("24HourTime") === "true";
            document.getElementById("timeFormatToggle").checked = is24Hour;

            let useFahrenheit = localStorage.getItem("useFahrenheit") === "true";
            document.getElementById("tempUnitToggle").checked = useFahrenheit;
        }

        document.getElementById("darkModeToggle").addEventListener("change", function() {
            let isChecked = this.checked;
            localStorage.setItem("darkMode", isChecked);
            document.body.classList.toggle("dark-mode", isChecked);
        });

        document.getElementById("timeFormatToggle").addEventListener("change", function() {
            let isChecked = this.checked;
            localStorage.setItem("24HourTime", isChecked);
        });

        document.getElementById("tempUnitToggle").addEventListener("change", function() {
            let isChecked = this.checked;
            localStorage.setItem("useFahrenheit", isChecked);
            // Update weather when the temperature unit is changed
            getLocation();
        });

        function detectDarkMode() {
            let userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes("mac os x") || userAgent.includes("android") || userAgent.includes("iphone")) {
                document.body.classList.add("dark-mode");
                localStorage.setItem("darkMode", "true");
            }
        }

        setInterval(updateTime, 1000);
        updateTime();
        getLocation();
        applyPreferences();
        detectDarkMode();
    </script>

</body>
</html>
